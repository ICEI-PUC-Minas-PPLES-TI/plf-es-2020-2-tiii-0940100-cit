<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIT</title>
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/css/bootstrap-select.min.css" crossorigin="anonymous">
    <link rel="icon" href="./assets/icons/favicon.ico" />
</head>

<body>

    <div>
        <div class="auth-background">
            <div class="auth-container d-block">
                <a class="btn btn-outline-success position-absolute" href="../index.html">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <img src="../assets/img/citlogo.svg" width="150px" alt="CIT Logo" class="d-block m-auto">
                <h3 class="auth-container-title text-center">CIT</h3>
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active" id="nav-fisica-tab" data-toggle="tab" href="#nav-fisica" role="tab" aria-controls="nav-fisica" aria-selected="true">Sou Pessoa Física</a>
                        <a class="nav-item nav-link" id="nav-instituicao-tab" data-toggle="tab" href="#nav-instituicao" role="tab" aria-controls="nav-instituicao" aria-selected="false">Sou uma instituição</a>
                    </div>
                </nav>
                <br>
                <div class="tab-content" id="nav-tabContent">
                    <!-- Pessoa Física -->
                    <div class="tab-pane fade show active" id="nav-fisica" role="tabpanel" aria-labelledby="nav-fisica-tab">
                        <form id="formCidadao">
                            <div class="form-group">
                                <label for="txtNomeCidadao">Nome completo</label>
                                <input type="text" class="form-control" id="txtNomeCidadao" name="txtNomeCidadao">
                            </div>
                            <div class="form-group">
                                <label for="txtEmailCidadao">E-Mail</label>
                                <input type="email" class="form-control" id="txtEmailCidadao" name="txtEmailCidadao">
                            </div>
                            <div class="form-group">
                                <label for="txtCPF">CPF</label>
                                <input type="text" class="form-control" id="txtCPF">
                            </div>
                            <div class="form-group">
                                <label for="txtSenhaCidadao">Senha</label>
                                <div class="input-group">
                                    <input type="password" class="form-control txtPasswords d-block" id="txtSenhaCidadao" name="txtSenhaCidadao" required>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary btnShowPassword" type="button">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary float-right" id="btnSubmitCidadao">
                                Cadastrar
                            </button>
                        </form>
                    </div>
                    <!-- Usuário de Organização -->
                    <div class="tab-pane fade" id="nav-instituicao" role="tabpanel" aria-labelledby="nav-instituicao-tab">
                        <form id="formInstiStep0">
                            <div class="form-group">
                                <label for="txtIdentificacao">Identificação</label>
                                <input type="text" class="form-control" required id="txtIdentificacao">
                            </div>
                            <div class="form-group">
                                <label for="txtCNPJ">CNPJ</label>
                                <input v-model="formData.cnpj" type="text" required class="form-control" id="txtCNPJ">
                            </div>
                            <div class="row">
                                <div class="col-12 col-md-5">
                                    <div class="form-group">
                                        <label>Estado</label>
                                        <select id="cbEstado" class="selectpicker" required>
                                            <option disabled selected value="">Selecione um</option>
                                            <option value="AC">Acre</option>
                                            <option value="AL">Alagoas</option>
                                            <option value="AP">Amapá</option>
                                            <option value="AM">Amazonas</option>
                                            <option value="BA">Bahia</option>
                                            <option value="CE">Ceará</option>
                                            <option value="DF">Distrito Federal</option>
                                            <option value="ES">Espírito Santo</option>
                                            <option value="GO">Goiás</option>
                                            <option value="MA">Maranhão</option>
                                            <option value="MT">Mato Grosso</option>
                                            <option value="MS">Mato Grosso do Sul</option>
                                            <option value="MG">Minas Gerais</option>
                                            <option value="PA">Pará</option>
                                            <option value="PB">Paraíba</option>
                                            <option value="PR">Paraná</option>
                                            <option value="PE">Pernambuco</option>
                                            <option value="PI">Piauí</option>
                                            <option value="RJ">Rio de Janeiro</option>
                                            <option value="RN">Rio Grande do Norte</option>
                                            <option value="RS">Rio Grande do Sul</option>
                                            <option value="RO">Rondônia</option>
                                            <option value="RR">Roraima</option>
                                            <option value="SC">Santa Catarina</option>
                                            <option value="SP">São Paulo</option>
                                            <option value="SE">Sergipe</option>
                                            <option value="TO">Tocantins</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-12 col-md-7">
                                    <div class="form-group">
                                        <label for="cbCidade" class="d-block">Cidade</label>
                                        <select id="cbCidade" class="selectpicker w-100" data-live-search="true" disabled title="Selecione uma">
                                            <option>Preencha o estado primeiro</option>
                                        </select>
                                          
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="txtDescricao">Descrição</label>
                                <textarea class="form-control auth-container-textarea" id="txtDescricao"></textarea>
                                </div>
                            <button type="button" class="btn btn-primary float-right" id="btnInstituicaoNextStep">
                                Próximo Passo
                            </button>
                            <br><br>
                        </form>
                        <form id="formInstiStep1">
                            <div class="form-group">
                                <label for="txtNome">Nome</label>
                                <input type="text" class="form-control" id="txtNome">
                            </div>
                            <div class="form-group">
                                <label for="txtEmail">E-Mail</label>
                                <input type="email" class="form-control" id="txtEmail">
                            </div>
                            <div class="form-group">
                                <label for="txtSenha">Senha</label>
                                <div class="input-group">
                                    <input type="password" class="form-control txtPasswords" id="txtSenha">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary btnShowPassword" type="button">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline-secondary" id="btnInstituicaoVoltar">
                                Voltar
                            </button>
                            <button type="button" class="btn btn-primary float-right" id="btnInstituicaoSubmit">
                                Cadastrar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="./assets/js/jquery-3.5.1.min.js"></script>
    <script src="./assets/js/popper.min.js"></script>
    <script src="./assets/js/bootstrap.min.js"></script>
    <script src="./assets/js/jquery.mask.min.js"></script>
    <script src="./assets/js/bootstrap-select.min.js"></script>
    <script src="/assets/js/cit.js"></script>
</body>

<script>
    $(function() { // Linha equivalente a:  document.addEventListener("DOMContentLoaded", function(event) { });
        $("#btnInstituicaoNextStep").click(function() { // Equivalente a: document.getElementById("btnInstituicaoNextStep").addEventListener("click", function(){});
            $("#formInstiStep0").hide(); //Equivalente a: document.getElementById("formInstiStep0").style.display = "none";
            $("#formInstiStep1").show(); //Equivalente a: document.getElementById("formInstiStep1").style.display = "block";
        });
        $("#btnInstituicaoVoltar").click(function() {
            $("#formInstiStep1").hide();
            $("#formInstiStep0").show();
        });
        $(".btnShowPassword").click(function() { // Equivalente a: document.querySelectorAll("btnShowPassword").addEventListener("click", function(){});
            if($(".txtPasswords").first().attr('type') == 'text') $(".txtPasswords").attr('type', 'password');
            else $(".txtPasswords").attr('type', 'text');
        });
        $("#btnSubmitCidadao").click(function() {
            // Requisição Jquery Ajax, equivalente ao método fetch do js puro
            if(!$("#txtNomeCidadao").val() || !$("#txtEmailCidadao").val() || !$("#txtSenhaCidadao").val()) {
                alert("Campo nome, email e senha obrigatórios!");
                return;
            }
            $.ajax({
                url: "/cidadao",
                type: "POST",
                data: {
                    cidadao_nome: $("#txtNomeCidadao").val(),
                    cidadao_email: $("#txtEmailCidadao").val(),
                    cidadao_cpf: $("#txtCPF").val(),
                    cidadao_senha: $("#txtSenhaCidadao").val()
                },
                success: function(data, status){
                    document.cookie = "xcid="+data.token+";path=/";
                    alert("Cidadao cadastrado");
                    $("#txtNomeCidadao").val(""); //Equivalente a: document.getElementById("txtNomeCidadao").value = "";
                    $("#txtEmailCidadao").val("");
                    $("#txtCPF").val("");
                    $("#txtSenhaCidadao").val("");
                    window.location.href = "../dashboard/cidadao.html";
                },
                error: function(data, status){
                    alert("Erro ao cadastrar");
                },
            });
        });
        
        $("#btnInstituicaoSubmit").click(function() {
            if(!$("#txtIdentificacao").val() || !$("#txtCNPJ").val() || !$("#cbEstado").val() || !$("#txtSenha").val() || !$("#cbCidade").val() || !$("#txtNome").val() || !$("#txtEmail").val() ) {
                alert("Todos os campos são obrigatórios!");
                return;
            }
            $.ajax({
                url: "/organizacao",
                type: "POST",
                data: {
                    nome: $("#txtIdentificacao").val(),
                    descricao: $("#txtDescricao").val(),
                    cnpj: $("#txtCNPJ").val(),
                    uf: $("#cbEstado").val(),
                    cidade: $("#cbCidade").val(),
                    usuario_email: $("#txtEmail").val(),
                    usuario_nome: $("#txtNome").val(),
                    usuario_senha: $("#txtSenha").val()
                },
                success: function(data, status){
                    alert("Instituição cadastrada");
                    $("#txtIdentificacao").val(""),
                    $("#txtDescricao").val(""),
                    $("#txtCNPJ").val(""),
                    $("#cbEstado").val(""),
                    $("#cbCidade").val(""),
                    $("#txtEmail").val(""),
                    $("#txtNome").val(""),
                    $("#txtSenha").val("")
                    document.cookie = "xorgao="+data.token+";path=/";
                },
                error: function(data, status){
                    alert("Erro ao cadastrar");
                },
            });
        })
        $("#cbEstado").change(function(){
            if(this.value != ""){
                $("#cbCidade").attr("disabled", false)
                $("#cbCidade").html("")
                $("#cbCidade").selectpicker('refresh');
                $.ajax({
                    url: "https://servicodados.ibge.gov.br/api/v1/localidades/estados/"+this.value+"/municipios",
                    type: "GET",
                    success: function(data, status){
                        for(let i=0;i<data.length;i++) {
                            $("#cbCidade").append("<option>"+data[i].nome+"</option>")
                        }
                        $("#cbCidade").selectpicker('refresh');
                    },
                    error: function(data, status){
                        alert("Erro ao cadastrar");
                    },
                });
            }
        })
        $("#txtCPF").mask('000.000.000-00', {reverse: true});
        $("#txtCNPJ").mask('00.000.000/0000-00', {reverse: true});

    });
</script>

<style>

    #formCidadao{
        height: 400px;
    }
    #formInstiStep1{
        display: none;
    }

    a{
        text-decoration: none;
    }

    .auth-background{
        background: #38AE90;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        min-height: 100%;
    }
    .auth-container{
        width: 600px;
        padding: 20px;
        background: white;
        margin: 100px auto 100px auto;
        border-radius: 5px;
    }
    @media only screen and (max-width: 600px) {
        .auth-container{
            width: 98%;
            margin: 1%;
        }
    }
    .auth-container-title{
        font-family: 'Tillana', cursive;
        color: #38AE90;
    }
    .auth-container-textarea{
        resize: none;
    }
    .nav-item{
        cursor: pointer;
    }
</style>

</html>